# ПРИЛОЖЕНИЕ А. ТЕКСТ ПРОГРАММЫ - ЧАСТЬ 3: БАЗА ДАННЫХ И ИТОГИ

## 1. СТРУКТУРА БАЗЫ ДАННЫХ

### Таблица 3 – Таблицы базы данных

| № | Таблица | Поля | Назначение |
|---|---------|------|------------|
| 1 | roles | 4 | Роли пользователей (admin, manager, customer, guest) |
| 2 | users | 9 | Пользователи системы |
| 3 | user_roles | 4 | Связь пользователей и ролей (many-to-many) |
| 4 | categories | 5 | Категории товаров (Мотоциклы, Скутеры и т.д.) |
| 5 | products | 14 | Товары магазина |
| 6 | product_categories | 3 | Связь товаров и категорий |
| 7 | inventory | 4 | Остатки товаров на складе |
| 8 | orders | 9 | Заказы покупателей |
| 9 | order_items | 5 | Позиции заказов |
| 10 | cart | 5 | Корзина покупок |

---

## 2. SQL СХЕМА (ОСНОВНЫЕ ТАБЛИЦЫ)

### 2.1. Таблица roles

```sql
CREATE TABLE roles (
  id SERIAL PRIMARY KEY,
  name VARCHAR(50) UNIQUE NOT NULL,
  description TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO roles (name, description) VALUES
('admin', 'Администратор системы'),
('manager', 'Менеджер магазина'),
('customer', 'Покупатель'),
('guest', 'Гость');
```

---

### 2.2. Таблица users

```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  first_name VARCHAR(100) NOT NULL,
  last_name VARCHAR(100) NOT NULL,
  phone VARCHAR(20),
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP
);

CREATE INDEX idx_users_email ON users(email);
```

---

### 2.3. Таблица products

```sql
CREATE TABLE products (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  slug VARCHAR(255) UNIQUE NOT NULL,
  sku VARCHAR(100) UNIQUE NOT NULL,
  description TEXT,
  price DECIMAL(10,2) NOT NULL,
  old_price DECIMAL(10,2),
  brand VARCHAR(100),
  image_url VARCHAR(500),
  is_active BOOLEAN DEFAULT TRUE,
  is_featured BOOLEAN DEFAULT FALSE,
  weight DECIMAL(10,2),
  dimensions VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP
);

CREATE INDEX idx_products_slug ON products(slug);
CREATE INDEX idx_products_sku ON products(sku);
```

---

### 2.4. Таблица orders

```sql
CREATE TABLE orders (
  id SERIAL PRIMARY KEY,
  order_number VARCHAR(50) UNIQUE NOT NULL,
  user_id INTEGER REFERENCES users(id),
  total_amount DECIMAL(10,2) NOT NULL,
  status VARCHAR(50) DEFAULT 'pending',
  payment_status VARCHAR(50) DEFAULT 'pending',
  shipping_address TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP
);

CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_order_number ON orders(order_number);
```

---

### 2.5. Таблица order_items

```sql
CREATE TABLE order_items (
  id SERIAL PRIMARY KEY,
  order_id INTEGER REFERENCES orders(id),
  product_id INTEGER REFERENCES products(id),
  quantity INTEGER NOT NULL,
  price DECIMAL(10,2) NOT NULL
);

CREATE INDEX idx_order_items_order_id ON order_items(order_id);
```

---

## 3. ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ (.env)

```env
# Сервер
PORT=3003
NODE_ENV=development

# База данных
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=motoshop

# JWT
JWT_SECRET=your_secret_key_here

# Email (опционально)
SMTP_HOST=smtp.mail.ru
SMTP_PORT=465
SMTP_USER=your_email@mail.ru
SMTP_PASS=your_password
```

---

## 4. PACKAGE.JSON

### 4.1. Backend (server/package.json)

```json
{
  "name": "motoshop-server",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "node server.js",
    "dev": "node --watch server.js",
    "test": "jest --verbose --coverage"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.2",
    "knex": "^3.0.1",
    "pg": "^8.11.3",
    "csv-writer": "^1.6.0"
  },
  "devDependencies": {
    "jest": "^29.7.0",
    "supertest": "^6.3.3"
  }
}
```

---

### 4.2. Frontend (client/package.json)

```json
{
  "name": "motoshop-client",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "axios": "^1.6.2"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.2.1",
    "vite": "^5.0.8",
    "tailwindcss": "^3.3.6",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.32"
  }
}
```

---

## 5. ИТОГОВАЯ СТАТИСТИКА ПРОЕКТА

### Таблица 4 – Общая статистика

| Категория | Количество |
|-----------|------------|
| **Backend модули** | 9 |
| **Frontend модули** | 14 |
| **Таблицы БД** | 10 |
| **API эндпоинты** | 30+ |
| **Страницы** | 11 |
| **Роли пользователей** | 4 |
| **Общее количество строк кода** | ~6,000 |

---

### Таблица 5 – Распределение кода

| Компонент | Строк кода | Процент |
|-----------|------------|---------|
| Frontend (React) | ~3,330 | 55% |
| Backend (Node.js) | ~2,580 | 43% |
| База данных (SQL) | ~90 | 2% |
| **Итого** | **~6,000** | **100%** |

---

## 6. ОСНОВНЫЕ ФУНКЦИИ СИСТЕМЫ

### 6.1. Для пользователей (customer)
- ✅ Регистрация и авторизация
- ✅ Просмотр каталога товаров
- ✅ Поиск и фильтрация товаров
- ✅ Быстрый просмотр товара
- ✅ Добавление в корзину
- ✅ Оформление заказа
- ✅ Просмотр истории заказов
- ✅ Управление профилем

### 6.2. Для менеджеров (manager)
- ✅ Все функции пользователя
- ✅ Просмотр статистики дашборда
- ✅ Создание товаров
- ✅ Редактирование товаров
- ✅ Удаление товаров
- ✅ Управление ценами
- ✅ Изменение статусов заказов
- ✅ Экспорт данных в CSV

### 6.3. Для администраторов (admin)
- ✅ Все функции менеджера
- ✅ Управление пользователями
- ✅ Назначение ролей
- ✅ Активация/деактивация пользователей
- ✅ Полный доступ к статистике
- ✅ Управление категориями

---

## 7. БЕЗОПАСНОСТЬ

### 7.1. Реализованные меры
- ✅ Хэширование паролей (bcrypt, 10 раундов)
- ✅ JWT токены с ограниченным сроком действия (24 часа)
- ✅ Проверка ролей и прав доступа
- ✅ Параметризованные SQL-запросы (защита от SQL-инъекций)
- ✅ CORS настройка
- ✅ Валидация входных данных
- ✅ Защищенные маршруты (ProtectedRoute)

---

## 8. ТЕХНОЛОГИИ И БИБЛИОТЕКИ

### 8.1. Backend
- **Node.js** - Серверная платформа
- **Express.js** - Веб-фреймворк
- **PostgreSQL** - Реляционная БД
- **Knex.js** - Query builder
- **JWT** - Токены авторизации
- **bcrypt** - Хэширование паролей
- **csv-writer** - Экспорт в CSV

### 8.2. Frontend
- **React 18** - UI библиотека
- **Vite** - Сборщик
- **React Router** - Маршрутизация
- **Axios** - HTTP клиент
- **TailwindCSS** - CSS фреймворк
- **Context API** - Управление состоянием

---

## 9. СТРУКТУРА ФАЙЛОВ ПРОЕКТА

```
MotoShop/
├── client/                 # Frontend
│   ├── src/
│   │   ├── components/
│   │   ├── contexts/
│   │   ├── pages/
│   │   ├── App.jsx
│   │   └── main.jsx
│   └── package.json
│
├── server/                 # Backend
│   ├── controllers/
│   ├── middleware/
│   ├── routes/
│   ├── db/
│   ├── server.js
│   └── package.json
│
├── database/              # SQL скрипты
│   └── schema.sql
│
├── docs/                  # Документация
│   ├── Приложение_А_Часть_1_Backend.md
│   ├── Приложение_А_Часть_2_Frontend.md
│   └── Приложение_А_Часть_3_БД_и_Итоги.md
│
└── README.md
```

---

## 10. ЗАКЛЮЧЕНИЕ

Проект **MotoShop** представляет собой полнофункциональный интернет-магазин мототехники, разработанный с использованием современного технологического стека. Приложение включает в себя клиентскую часть на React, серверную часть на Node.js/Express и базу данных PostgreSQL.

**Основные достижения:**
- ✅ Полноценная система аутентификации и авторизации
- ✅ Ролевая модель доступа (4 роли)
- ✅ CRUD операции для всех сущностей
- ✅ Административная панель с статистикой
- ✅ Экспорт данных в CSV
- ✅ Адаптивный дизайн
- ✅ Безопасность и защита данных

**Общий объем работы:**
- Модулей: 23
- Строк кода: ~6,000
- Таблиц БД: 10
- API эндпоинтов: 30+
- Время разработки: ~200 часов
